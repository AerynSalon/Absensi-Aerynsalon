<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>AerynSalon - Absensi QR (v1.3.1)</title>
  <meta name="color-scheme" content="light dark">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/html5-qrcode" defer></script>
  <script src="./config.js" defer></script>
  <script src="./script.js" defer></script>
  <style>
    .ticker{position:relative;overflow:hidden;background:#f5f3ff;color:#4c1d95;border-radius:9999px}
    .ticker__inner{white-space:nowrap;display:inline-block;will-change:transform;animation:tickerAnim 20s linear infinite;padding:0.25rem 0}
    .ticker:hover .ticker__inner{animation-play-state:paused}
    @keyframes tickerAnim{0%{transform:translateX(100%)}100%{transform:translateX(-100%)}}
    .ticker__fade:before,.ticker__fade:after{content:"";position:absolute;top:0;width:64px;height:100%;pointer-events:none}
    .ticker__fade:before{left:0;background:linear-gradient(to right, rgba(245,243,255,1), rgba(245,243,255,0))}
    .ticker__fade:after{right:0;background:linear-gradient(to left, rgba(245,243,255,1), rgba(245,243,255,0))}
  </style>

  <style>
    :root{ --brand:#7c3aed; --brand-hover:#6d28d9; --brand-soft:#ede9fe; --brand-text:#4c1d95; }
    .btn-brand{ background:var(--brand); color:#fff; border-radius:0.75rem; padding:0.5rem 0.75rem; }
    .btn-brand:hover{ background:var(--brand-hover); }
    .badge-brand{ background:var(--brand-soft); color:var(--brand-text); border-radius:9999px; padding:0.125rem 0.5rem; font-size:0.75rem; }
    .link-brand{ color:var(--brand); }
    .link-brand:hover{ text-decoration:underline; }
  </style>

</head>
<body class="bg-gray-50 text-gray-900 selection:bg-purple-200">
  <div class="max-w-4xl mx-auto p-4 md:p-6">
    <header class="mb-4 md:mb-6 flex flex-col md:flex-row md:items-center md:justify-between gap-3">
      <div class="flex items-center gap-3">
        <div class="w-10 h-10 rounded-2xl bg-purple-600 text-white grid place-items-center font-bold">AS</div>
        <div>
          <h1 class="text-2xl md:text-3xl font-bold tracking-tight">AerynSalon — Absensi QR</h1>
          <p class="text-xs text-gray-500">Tanpa backend sendiri • Google Sheets + Apps Script</p>
        </div>
      </div>
      <div class="flex items-center gap-3">
        <div class="text-right">
          <div id="clock" class="font-mono text-2xl md:text-3xl">--:--:--</div>
          <div id="clockDate" class="text-xs text-gray-600">—</div>
          <div id="clockMeta" class="text-[11px] text-gray-500">Sumber: — | Offset: — | Sinkron: —</div>
        </div>
        <button id="btnResync" class="btn-brand active:scale-[.98] transition">Sync ulang</button>
        <span class="badge-brand">v1.3.1</span>
        <button id="btnAdmin" class="px-3 py-2 rounded-xl bg-gray-800 text-white hover:bg-gray-900 active:scale-[.98] transition">Admin</button>
      </div>
    </header>

    <div class="mb-6 ticker ticker__fade" aria-label="Pengumuman berjalan">
      <div id="tickerTrack" class="ticker__inner font-medium"></div>
    </div>

    <div class="grid gap-6">
      <section class="bg-white rounded-2xl shadow-sm ring-1 ring-black/5 p-4">
        <h2 class="text-lg font-semibold mb-2">1) Pilih Mode</h2>
        <div class="flex flex-wrap gap-3 items-center">
          <button id="btnCheckin" class="btn-brand">Check-In</button>
          <button id="btnCheckout" class="btn-brand">Check-Out</button>
          <span id="modeBadge" class="ml-auto text-xs px-3 py-1 rounded-full bg-gray-100 text-gray-700">Mode: Check-In</span>
        </div>
      </section>

      <section class="bg-white rounded-2xl shadow-sm ring-1 ring-black/5 p-4">
        <h2 class="text-lg font-semibold mb-2">2) Kamera & Scan</h2>
        <div class="flex flex-wrap items-center gap-3 mb-3">
          <select id="cameraSelect" class="border rounded-xl px-3 py-2 min-w-[220px] bg-gray-50"></select>
          <button id="btnBackCam" class="px-3 py-2 rounded-xl bg-gray-800 text-white hover:bg-gray-900">Pakai kamera belakang</button>
          <button id="btnRestart" class="px-3 py-2 rounded-xl bg-gray-100 text-gray-800 hover:bg-gray-200">Restart scanner</button>
        </div>
        <div class="rounded-2xl overflow-hidden border bg-black/80">
          <div id="reader" class="aspect-video"></div>
        </div>
        <p id="scanStatus" class="mt-3 text-sm text-gray-600">Meminta akses kamera...</p>
        <p class="text-xs text-gray-500 mt-1">Tips: gunakan <strong>HTTPS</strong>, izinkan kamera, dan arahkan QR pada area kotak.</p>
      </section>

      <section class="bg-white rounded-2xl shadow-sm ring-1 ring-black/5 p-4">
        <h2 class="text-lg font-semibold mb-2">3) Hasil</h2>
        <div class="grid md:grid-cols-2 gap-3 text-sm">
          <div><span class="font-semibold">ID Karyawan:</span> <span id="empId">-</span></div>
          <div><span class="font-semibold">Nama:</span> <span id="empName">-</span></div>
          <div><span class="font-semibold">Jenis:</span> <span id="empType">-</span></div>
          <div><span class="font-semibold">Waktu (online):</span> <span id="empTime">-</span></div>
        </div>
        <div id="serverResponse" class="mt-3 text-sm"></div>
        <div class="mt-4 flex flex-wrap gap-2">
          <button id="btnKirim" class="px-4 py-2 rounded-xl bg-purple-600 text-white disabled:opacity-50 hover:bg-purple-700" disabled>Kirim ke Google Sheets</button>
          <button id="btnUlang" class="px-4 py-2 rounded-xl bg-gray-100 text-gray-800 hover:bg-gray-200">Ulangi Scan</button>
        </div>
      </section>

      <section class="bg-white rounded-2xl shadow-sm ring-1 ring-black/5 p-4">
        <h2 class="text-lg font-semibold mb-2">Alternatif: Input Manual</h2>
        <form id="manualForm" class="grid md:grid-cols-4 gap-3">
          <input class="border rounded-xl px-3 py-2 bg-gray-50" placeholder="ID Karyawan" id="m_id" required>
          <input class="border rounded-xl px-3 py-2 bg-gray-50" placeholder="Nama" id="m_nama" required>
          <select class="border rounded-xl px-3 py-2 bg-gray-50" id="m_type">
            <option value="IN">IN</option>
            <option value="OUT">OUT</option>
          </select>
          <button class="px-4 py-2 rounded-xl bg-purple-600 text-white hover:bg-purple-700">Kirim Manual</button>
        </form>
      </section>

      <footer class="text-center text-xs text-gray-500 pb-8">
        <p>Butuh QR karyawan? <a class="text-purple-700 underline" href="qrgen.html">Buat QR di sini</a>.</p>
      </footer>
    </div>
  </div>
  <div id="toast" class="fixed bottom-4 left-1/2 -translate-x-1/2 px-4 py-2 rounded-xl bg-gray-900 text-white text-sm shadow-lg hidden"></div>

  <!-- Admin Login Modal -->
  <div id="adminModal" class="fixed inset-0 bg-black/40 hidden items-center justify-center p-4 z-50">
    <div class="bg-white rounded-2xl shadow-xl w-full max-w-sm p-5">
      <h3 class="text-lg font-semibold mb-2">Login Admin</h3>
      <p class="text-sm text-gray-600 mb-4">Masukkan password admin untuk membuka dashboard.</p>
      <input id="adminPass" type="password" class="w-full border rounded-xl px-3 py-2 mb-3" placeholder="Password admin" />
      <div class="flex items-center justify-between text-xs text-gray-500 mb-3">
        <span>Default: <code class="bg-gray-100 px-1 rounded">aeryn123</code></span>
        <a class="text-purple-700 hover:underline" href="admin.html">Buka dashboard</a>
      </div>
      <div class="flex justify-end gap-2">
        <button id="adminCancel" class="px-3 py-2 rounded-xl bg-gray-200 text-gray-800 hover:bg-gray-300">Batal</button>
        <button id="adminLogin" class="px-3 py-2 rounded-xl bg-purple-600 text-white hover:bg-purple-700">Masuk</button>
      </div>
    </div>
  </div>

</body>
</html>
